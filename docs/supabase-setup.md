# Supabase テーブル初期設定

このプロジェクトの `recipes` テーブルを作成する手順です。

## 前提
- Supabase のプロジェクトが作成済み
- `.env.local` に以下を設定済み
  - `NEXT_PUBLIC_SUPABASE_URL`
  - `NEXT_PUBLIC_SUPABASE_PUBLISHABLE_DEFAULT_KEY`

## 手順
1. Supabase ダッシュボードを開く
2. `SQL Editor` を開く
3. 下記の SQL を実行する

```sql
create table if not exists public.recipes (
  id bigint generated by default as identity primary key,
  title text not null,
  description text,
  time text,
  difficulty text,
  calories text,
  author text,
  likes text,
  tag text,
  servings text,
  ingredients text[],
  steps text[],
  user_id uuid references auth.users(id),
  created_at timestamptz not null default now()
);
```

## セキュリティ (RLS/ポリシー)
安全側の設定として、RLS を有効化し「匿名は読み取りのみ、作成は認証済みユーザーのみ」を許可します。

```sql
alter table public.recipes enable row level security;

create policy "public read recipes"
on public.recipes
for select
to anon, authenticated
using (true);

create policy "authenticated insert recipes"
on public.recipes
for insert
to authenticated
with check (auth.uid() = user_id);

create policy "owner update recipes"
on public.recipes
for update
to authenticated
using (auth.uid() = user_id)
with check (auth.uid() = user_id);

create policy "owner delete recipes"
on public.recipes
for delete
to authenticated
using (auth.uid() = user_id);
```

注意: この設定では、未ログインのユーザーは登録できません。登録を許可する場合は認証を導入するか、サーバー側でサービスロールキーを使った登録処理に切り替えてください。

## サンプルデータ投入
`recipes` テーブルにサンプルレシピを 6 件登録します。

```sql
insert into public.recipes
  (title, description, time, difficulty, calories, author, likes, tag, servings, ingredients, steps)
values
  (
    '焦がしバターのきのこリゾット',
    '白ワインと出汁でゆっくり炊いて、香りを立たせる一皿。',
    '35分',
    '中級',
    '520kcal',
    'Yui',
    '1200',
    '濃厚',
    '2人分',
    array['米 1合', 'ブラウンマッシュルーム 120g', '白ワイン 大さじ2', 'バター 15g', 'チキンブロス 500ml', '粉チーズ 大さじ2'],
    array['きのこを薄切りにして、フライパンでバターと一緒に香ばしく炒める。', '米を加えて透明感が出るまで炒め、白ワインを回し入れる。', '温めたブロスを少しずつ加え、弱火で20分ほど炊く。', '仕上げに粉チーズを混ぜ、塩で味を整える。']
  ),
  (
    'レモン香るサーモンのロースト',
    'ハーブと柑橘の香りで爽やかに仕上げるオーブン料理。',
    '25分',
    '初級',
    '430kcal',
    'Ren',
    '980',
    'ヘルシー',
    '2人分',
    array['生鮭 2切れ', 'レモン 1/2個', 'オリーブオイル 大さじ1', 'タイム 適量', '塩 小さじ1/3', 'こしょう 少々'],
    array['サーモンに塩こしょうをし、オリーブオイルを回しかける。', 'レモンの輪切りとタイムをのせ、200℃のオーブンで12分焼く。', '仕上げにレモン汁を軽く絞って香りを立たせる。']
  ),
  (
    '黒ごま担々スープ',
    '豆乳ベースでまろやか、スパイスで奥行きを作る。',
    '20分',
    '初級',
    '390kcal',
    'Mao',
    '860',
    '温活',
    '2人分',
    array['豆乳 400ml', '鶏ひき肉 120g', '黒すりごま 大さじ2', '味噌 大さじ1', '豆板醤 小さじ1', 'にんにく 1片'],
    array['にんにくを炒め、香りが立ったら鶏ひき肉を加えて炒める。', '豆板醤と味噌を加え、香りが出たら豆乳を注ぐ。', '黒すりごまを混ぜ、弱火で温めて仕上げる。']
  ),
  (
    '自家製トマトソースのラザニア',
    '低温で煮詰めたソースが主役のごちそうレシピ。',
    '60分',
    '上級',
    '640kcal',
    'Sora',
    '1600',
    'おもてなし',
    '4人分',
    array['ラザニアシート 6枚', 'トマト缶 1缶', '合いびき肉 200g', '玉ねぎ 1/2個', '赤ワイン 50ml', 'モッツァレラ 100g'],
    array['玉ねぎを炒め、合いびき肉を加えて色が変わるまで炒める。', 'トマト缶と赤ワインを加え、弱火で30分煮詰める。', '耐熱皿にソース、ラザニアシート、チーズを重ねる。', '200℃のオーブンで20分焼く。']
  ),
  (
    '焼きねぎと鶏つくねの小鍋',
    '甘いねぎと生姜の香りで、やさしく整う味わい。',
    '30分',
    '中級',
    '480kcal',
    'Kiko',
    '1100',
    'ほっとする',
    '2人分',
    array['鶏ひき肉 200g', '長ねぎ 1本', '生姜 1片', '醤油 大さじ1', 'だし 500ml', 'みりん 大さじ1'],
    array['長ねぎを焼き色がつくまで焼き、香ばしさを出す。', '鶏ひき肉に生姜と醤油を混ぜ、つくねを成形する。', 'だしとみりんを温め、焼いたねぎとつくねを煮る。']
  ),
  (
    'バジル香る冷製パスタ',
    'トマトとモッツァレラで、軽やかな昼のご褒美。',
    '15分',
    '初級',
    '360kcal',
    'Haru',
    '740',
    '夏向き',
    '2人分',
    array['カッペリーニ 160g', 'トマト 2個', 'モッツァレラ 80g', 'バジル 適量', 'オリーブオイル 大さじ2', '塩 小さじ1/2'],
    array['トマトを角切りにし、塩とオリーブオイルで和える。', 'カッペリーニを茹でて冷水で冷やし、水気を切る。', 'トマトとモッツァレラを合わせ、バジルを散らす。']
  );
```

## トラブルシュート
- `Could not find the table 'public.recipes' in the schema cache` が出る場合は、Supabase ダッシュボードで「Database → Schema cache refresh」を実行する。
